<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <title>The HTML5 Herald</title>
</head>

<script>
  var path = "/"

  $(document).ready(function() {
    refreshData();
  })    

  function refreshData(element) {
    var temp = path;
    if (element == undefined) ;
    else temp = temp + element.innerHTML + "/";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.status == 200) {
        if (element == undefined) ;
        else path = path + element.innerHTML + "/";
        var list = document.getElementById("list");
        while(list.firstChild) list.removeChild(list.firstChild);
        var data = JSON.parse(this.responseText.trim());
        console.log(data);
        var directories = data["directories"];
        var files = data["files"];
        
        $("#list").append("<ul id='dirs'>Directories</ul>")
        for(var i = 0; i < directories.length; ++i)
        {
          $("#dirs").append("<ul onclick='refreshData(this)'>" + directories[i] + "</ul>")
        }
        
        $("#list").append("<ul id='files'>Files</ul>")
        for(var i = 0; i < files.length; ++i)
        {          
          $("#files").append("<ul>" + files[i] + "</ul>")
        }
      } if (this.status >= 400) {
        path.replace(element.innerHTML, "");
      }
    };
    xhttp.open("GET", "/?path=" + encodeURIComponent(temp), true);
    xhttp.send();
  }
</script>

<body>
  <h1>Hello, world!</h1>
  <div id="list">
    <ul id="dirs">
    </ul>
    <ul id="files">
    </ul>
  </div>
  
  <form action="/download" method="get">
    <input type="hidden" name="path" value="dd.jpg">
    <input type="submit" value="Submit">
  </form>

</body>
</html>